console.log("[import] git: e34c91357972cbaed99e90e4e46b372c0a1c5ead, stamp: 2F26904634EAB7DA");
!function(e){function n(){}function t(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(e,this)}function o(e,n){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(n):(e._handled=!0,void t._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var o;try{o=t(e._value)}catch(e){return void r(n.promise,e)}i(n.promise,o)}else(1===e._state?i:r)(n.promise,e._value)}))}function i(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var o=n.then;if(n instanceof t)return e._state=3,e._value=n,void u(e);if("function"==typeof o)return void f(function(e,n){return function(){e.apply(n,arguments)}}(o,n),e)}e._state=1,e._value=n,u(e)}catch(n){r(e,n)}}function r(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&t._immediateFn(function(){e._handled||t._unhandledRejectionFn(e._value)});for(var n=0,i=e._deferreds.length;n<i;n++)o(e,e._deferreds[n]);e._deferreds=null}function f(e,n){var t=!1;try{e(function(e){t||(t=!0,i(n,e))},function(e){t||(t=!0,r(n,e))})}catch(e){if(t)return;t=!0,r(n,e)}}var c=setTimeout;t.prototype.catch=function(e){return this.then(null,e)},t.prototype.then=function(e,t){var i=new this.constructor(n);return o(this,new function(e,n,t){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.promise=t}(e,t,i)),i},t.all=function(e){var n=Array.prototype.slice.call(e);return new t(function(e,t){function o(r,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var f=u.then;if("function"==typeof f)return void f.call(u,function(e){o(r,e)},t)}n[r]=u,0==--i&&e(n)}catch(e){t(e)}}if(0===n.length)return e([]);for(var i=n.length,r=0;r<n.length;r++)o(r,n[r])})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(n){n(e)})},t.reject=function(e){return new t(function(n,t){t(e)})},t.race=function(e){return new t(function(n,t){for(var o=0,i=e.length;o<i;o++)e[o].then(n,t)})},t._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){c(e,0)},t._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},t._setImmediateFn=function(e){t._immediateFn=e},t._setUnhandledRejectionFn=function(e){t._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=t:e.Promise||(e.Promise=t)}(this);
!function(){function e(e){return function(e){if(20!==e.length)throw new Error("Invalid SHA1 hash")}(e),function(e){return[].map.call(e,function(e){return(256|e).toString(16).slice(1)}).join("")}(e)}function n(){console.log("cancelConversion"),d=!0,b&&(b.terminate(),b=null),y.forEach(function(e){e.onload=function(){},e.abort()}),y=[],h&&(h=null);for(var e in w){var n=w[e];delete w[e],n.reject({status:5,message:"Canceled import."})}}function t(){return d}function r(e,n){function r(e,r){if(!t()){var o=new FileReader;o.onload=function(){t()?console.log("reader loaded. canceled -- skipping callback"):n(r,new Uint8Array(o.result))},o.readAsArrayBuffer(e)}}var o=e.dataTransfer,i=Array.prototype.forEach;if(d=!1,y=[],o.items){var a=!1;if(i.call(o.items,function(e){if(e.webkitGetAsEntry){var n=e.webkitGetAsEntry();if(n){var t=n.name;n.isDirectory?n.getFile("Data",null,function(e){return e.file(function(e){return r(e,t)})}):n.isFile&&n.file(function(e){return r(e,t)}),a=!0}}}),a)return}i.call(o.files,function(e){return r(e,e.name)})}function o(){if(!h){var e=l()||"import.worker.js",n=function(e){try{b=new Worker(e)}catch(e){throw h=null,new Error("Failed to load the web worker. Please contact Figma for support.")}return b.onmessage=i,b};h=m?function(e,n){return new Promise(function(t,r){var o=new XMLHttpRequest;o.onload=function(){o.status>=200&&o.status<400&&t(o.response)},o.onloadend=function(){r(new Error("Failed to download the file importer. Please make sure you're connected to the internet and try again."))},o.open("GET",e),o.responseType=n,o.send(null)})}(e,"blob").then(function(e){return n(URL.createObjectURL(e))}):new Promise(function(t,r){t(n(e))})}return h}function i(n){var r=n.data;switch(r.type){case"ConversionFailureResponse":if((s=r).id in w){var o=w[s.id];delete w[s.id],o.reject({message:s.message,stack:s.stack})}break;case"ConversionSuccessResponse":var i=r;if(i.id in w){var a=w[i.id];delete w[i.id],t()?(g(100),a.reject({message:"Import canceled",stack:{}})):(g(20),function(n){return f(this,void 0,void 0,function(){var r,o,i,a,s,l;return p(this,function(f){switch(f.label){case 0:r=n.length,o=5,i=0,f.label=1;case 1:if(!(i<n.length))return[3,8];a=[],s=function(o){var i,s;return p(this,function(l){switch(l.label){case 0:if(i=n[o],t())throw new Error("Image upload canceled");if(s="application/octet-stream",u(i.bytes))s="image/png";else{if(!c(i.bytes))return console.log("warning: ignoring image with unknown type ("+Array.prototype.slice.call(i.bytes,0,10).map(function(e){return(256|e).toString(16).slice(-2)})+"...)"),[2,"continue"];s="image/jpeg"}return console.log("uploading image "+e(i.sha1Bytes)+" of type "+s),g(20+(0===r?0:80*o/r)),a.push(new Promise(function(n,t){var r=new XMLHttpRequest,o=!1;r.onload=function(){return o=!0},r.onloadend=function(){var e=y.indexOf(r);e>-1&&y.slice(e,1),o?(console.log("uploaded image "+i.name),n()):t()},r.open("POST","/api/upnode/image?purpose=canvas&sha1="+e(i.sha1Bytes)),r.setRequestHeader("Content-Type",s),y.push(r),r.send(i.bytes||null)})),[4,new Promise(function(e){return setTimeout(e,0)})];case 1:return l.sent(),[2]}})},l=i,f.label=2;case 2:return l<i+o&&l<n.length?[5,s(l)]:[3,5];case 3:f.sent(),f.label=4;case 4:return l++,[3,2];case 5:return[4,Promise.all(a)];case 6:f.sent(),f.label=7;case 7:return i+=o,[3,1];case 8:return[2]}})})}(i.result.images).then(function(){a.resolve(i.result)},function(){a.reject({message:"We ran into a problem. Please try again!",stack:{},imageUploadError:!0})}))}break;case"UpdateProgressMessage":var s=r;g&&g(s.percentage);break;default:console.warn("import shim got unsupported message: "+r.type)}}function a(e,n){if(e.length<n.length)return!1;for(var t=0;t<n.length;t++)if(e[t]!==n[t])return!1;return!0}function s(e){return o().then(function(n){return new Promise(function(t,r){var o=e.message.id;w[o]={resolve:t,reject:r},n.postMessage(e.message,e.buffers)})})}function u(e){return a(e,[137,80,78,71,13,10,26,10])}function c(e){return a(e,[255,216])}var l,f=function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(a,s)}u((r=r.apply(e,n||[])).next())})},p=function(e,n){function t(t){return function(a){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=o[2&t[0]?"return":t[0]?"throw":"next"])&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[0,i.value]),t[0]){case 0:case 1:i=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){s.label=t[1];break}if(6===t[0]&&s.label<i[1]){s.label=i[1],i=t;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(t);break}i[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(e,s)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,a])}}var r,o,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},g=function(e){},d=!1,h=null,m=!0,b=null,w={},v=0,y=[];"undefined"!=typeof Fig&&Fig||(Fig={}),function(e){l=e}(function(){return Fig.importWorkerURL}),Fig.convertFile=function(e,n){return new Promise(function(r,o){if(!t())if(u(e)||c(e)){var i=URL.createObjectURL(new Blob([e])),a=new Image;a.onerror=function(){o({message:"Invalid image",stack:(new Error).stack})},a.onload=function(){s({message:{type:"ImageConversionRequest",id:v++,bytes:e,width:a.width,height:a.height},buffers:[e.buffer]}).then(r,o),URL.revokeObjectURL(i)},a.src=i}else s({message:{type:"FileConversionRequest",id:v++,bytes:e,featureFlags:n},buffers:[e.buffer]}).then(r,o)})},Fig.disableWorkerBlob=function(){m=!1},Fig.cancelConversion=n,Fig.hasCanceled=t,Fig.setUpdateProgressCallback=function(e){g=e},Fig.extractFilesFromDropEvent=r}();
